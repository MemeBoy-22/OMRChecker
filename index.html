<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OMR Sheet Scanner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    input, button {
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h1>OMR Sheet Scanner</h1>

  <input type="file" id="imageInput" accept="image/*" />
  <br/>
  <canvas id="canvas" width="800" height="600"></canvas>
  <br/>
  <button id="processBtn">Process OMR Sheet</button>

  <script async src="https://docs.opencv.org/4.x/opencv.js" onload="onOpenCvReady();"></script>
  <script>
    let imgElement = null;
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");
    let input = document.getElementById("imageInput");

    input.addEventListener("change", function(e) {
      const reader = new FileReader();
      reader.onload = function(event) {
        imgElement = new Image();
        imgElement.onload = function() {
          canvas.width = imgElement.width;
          canvas.height = imgElement.height;
          ctx.drawImage(imgElement, 0, 0);
        }
        imgElement.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    function onOpenCvReady() {
      console.log("OpenCV.js is ready.");
    }

    document.getElementById("processBtn").onclick = function() {
      if (!imgElement) {
        alert("Please upload an image first.");
        return;
      }

      let src = cv.imread(canvas);
      let dst = new cv.Mat();
      cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY, 0);
      cv.imshow(canvas, dst);
      src.delete(); dst.delete();
      alert("Grayscale conversion done. Bubble detection will be added next.");
    };
  </script>
</body>
</html>
